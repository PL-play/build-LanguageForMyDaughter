<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    <title>WebAssembly 示例</title>

    <!-- 引入 CodeMirror 的 CSS -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.9/codemirror.min.css">
    <!-- 主题样式 -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.9/theme/monokai.min.css">

    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 0;
        }
        #header {
            background-color: #2c3e50;
            color: #fff;
            padding: 20px;
            text-align: center;
        }
        #container {
            display: flex;
            height: calc(100vh - 100px); /* 减去 header 和按钮的高度 */
        }
        #editor, #output {
            flex: 1;
            overflow: auto;
            padding: 10px;
        }
        #editor {
            /* CodeMirror 编辑器会自动填充这个容器 */
        }
        #output {
            background-color: #f0f0f0;
            border-left: 1px solid #ccc;
            font-family: monospace;
            white-space: pre-wrap;
        }
        #runButton {
            display: block;
            width: 100%;
            padding: 15px;
            background-color: #27ae60;
            color: #fff;
            border: none;
            cursor: pointer;
            font-size: 18px;
        }
        #runButton:hover {
            background-color: #2ecc71;
        }
    </style>
</head>
<body>
<div id="header">
    <h1>WebAssembly 示例</h1>
</div>

<!-- 运行按钮 -->
<button id="runButton" onclick="processInput()">运行代码</button>

<!-- 容器，包含代码编辑器和结果显示框 -->
<div id="container">
    <!-- 代码编辑器 -->
    <div id="editor"></div>
    <!-- 结果显示框 -->
    <pre id="output"></pre>
</div>

<!-- 引入 CodeMirror 的 JavaScript -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.9/codemirror.min.js"></script>
<!-- 引入代码模式 -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.9/mode/javascript/javascript.min.js"></script>

<!-- 在加载 WebAssembly 模块之前定义 Module 对象 -->
<script>
    // 定义变量
    var outputContent = '';
    var outputElement = document.getElementById('output');

    // 初始化 CodeMirror 编辑器
    var editor = CodeMirror(document.getElementById('editor'), {
        mode: 'javascript', // 根据需要更换语言模式
        theme: 'monokai',   // 选择主题
        lineNumbers: true,  // 显示行号
        value: ''           // 初始内容
    });

    // 配置 Module 对象
    var Module = {
        onRuntimeInitialized: function() {
            console.log('WebAssembly module loaded.');
        },
        print: function(text) {
            outputContent += text + '\n';
            outputElement.textContent = outputContent;
        },
        printErr: function(text) {
            console.error(text);
            outputContent += 'Error: ' + text + '\n';
            outputElement.textContent = outputContent;
        }
    };

    // 处理用户输入的代码并调用 WebAssembly 函数
    function processInput() {
        const codeInput = editor.getValue();
        if (codeInput.trim() === "") {
            alert("请输入一些代码。");
            return;
        }

        // 清空之前的输出内容
        outputContent = '';
        outputElement.textContent = '';

        // 调用 C 函数处理输入
        Module.ccall(
            'handle_file_content',  // C 函数名
            'void',                 // 返回值类型
            ['string'],             // 参数类型
            [codeInput]             // 参数值
        );

        // 去掉最后的 '\n'（如果有）
        if (outputContent.endsWith('\n')) {
            outputContent = outputContent.slice(0, -1);
            outputElement.textContent = outputContent;
        }
    }
</script>

<!-- 加载生成的 WebAssembly JavaScript 文件 -->
<script src="ZHI_wasm.js"></script>
</body>
</html>
